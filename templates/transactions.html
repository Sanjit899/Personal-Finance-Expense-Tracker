{% extends "layout.html" %}
{% block content %}
<h2 class="mb-4">All Transactions</h2>

<!-- Search Bar -->
<form method="get" action="{{ url_for('transactions') }}" class="row g-3 mb-4">
  <div class="col-md-6">
    <input type="text" name="q" class="form-control" placeholder="Search transactions..." value="{{ request.args.get('q', '') }}">
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-primary w-100">Search</button>
  </div>
  <div class="col-md-2">
    <a href="{{ url_for('transactions') }}" class="btn btn-secondary w-100">Clear</a>
  </div>
</form>

<!-- Transactions Table -->
<table class="table table-striped table-hover">
  <thead class="table-dark">
    <tr>
      <th>Date</th>
      <th>Type</th>
      <th>Amount</th>
      <th>Category</th>
      <th>Description</th>
      <th>Actions</th>  <!-- New column for actions -->
    </tr>
  </thead>
  <tbody>
    {% if transactions.items %}
      {% for t in transactions.items %}
        <tr>
          <td>{{ t.date.strftime('%Y-%m-%d') if t.date else '' }}</td>
          <td>{{ t.type }}</td>
          <td>â‚¹{{ "{:,.2f}".format(t.amount) }}</td>
          <td>{{ t.category.name if t.category else '' }}</td>
          <td>{{ t.description }}</td>
          <td>
            <a href="{{ url_for('edit_transaction', tx_id=t.id) }}" class="btn btn-sm btn-primary me-1">Edit</a>

            <!-- Delete form to send POST -->
            <form method="post" action="{{ url_for('delete_transaction', tx_id=t.id) }}" style="display:inline;" onsubmit="return confirm('Delete this transaction?');">
              <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
          </td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td colspan="6" class="text-center text-muted">No transactions found.</td>
      </tr>
    {% endif %}
  </tbody>
</table>

<!-- Pagination -->
<nav aria-label="Transaction navigation">
  <ul class="pagination">
    <li class="page-item {% if not transactions.has_prev %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('transactions', page=transactions.prev_num, q=request.args.get('q')) }}">Prev</a>
    </li>
    <li class="page-item {% if not transactions.has_next %}disabled{% endif %}">
      <a class="page-link" href="{{ url_for('transactions', page=transactions.next_num, q=request.args.get('q')) }}">Next</a>
    </li>
  </ul>
</nav>

<!-- Export Buttons -->
<div class="mt-4">
  <a class="btn btn-secondary me-2" href="{{ url_for('export_csv') }}">Export CSV</a>
  <a class="btn btn-danger" href="{{ url_for('export_pdf') }}">Export PDF</a>
</div>

{% endblock %}
